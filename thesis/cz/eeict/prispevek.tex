%--------------------------------------------------------------------------------
%
% Text pøíspìvku do sborníku EEICT
%
% Vytvoøil:  Jarek Jarcec Cecho
% Datum:     26.02.2007
% E-mail:    jarcec@jarcec.net
%
%--------------------------------------------------------------------------------
\documentclass{eeict}
\inputencoding{cp1250}
\usepackage[bf]{caption2}
%--------------------------------------------------------------------------------


\title{Bringing expert system into Ruby}
\author{Jaroslav \u{C}echo}
\programme{Bachelor Degree Programme (1), FIT BUT}
\emails{xcecho00@stud.fit.vutbr.cz}

\supervisor{Ing. Zdenìk Letko}
\emailv{iletko@fit.vutbr.cz}

\begin{document}
% -- Hlavièka práce --

\maketitle

% -- Abstrakt práce --
\selectlanguage{english}
\abstract{This paper describes a library called rbClips that makes CLIPS functionality available from Ruby. CLIPS is a public domain tool for building expert systems that was originally developed in NASA in 1990's. The tool itself is written in C but its user interface is very similar to Lisp language. Ruby is a modern dynamic scripting language that offers programmer flexible syntax, purely object environment, openness of objects and other interesting features. The library is ment to be used to build expert system for detection of possibly malicious code in antivirus software.}

%-------------------------------------------------------------------------------
\selectlanguage{czech}
\section{Úvod}
V tomto èlánku bych rád popsal svou bakaláøskou práci, ve které jsem propojil dvì technologie, systém pro tvorbu expertních systémù CLIPS a mladý skriptovací jazyk Ruby, do jednoho funkèního celku.

\textbf{Ruby}. Ruby~\cite{rubyProgrammingLanguage} je mladý dynamický skriptovací jazyk vytvoøený japonským inženýrem Yukihiro Matsumoto známým na internetu pod pøezdívkou Matz. Na popularitì získává až v poslední dobì kvùli døívìjší absenci anglicky psaných materiálù. Nabízí programátorovi plnì objektový jazyk s volnou syntaxí (napøíklad možnost vynechat závorky okolo argumentù funkcí na místech, kde to není syntakticky nejednoznaèné). Podobnì jako napøíklad prototypový Javascript umožnuje jakoukoliv tøídu znovu otevøít a upravit chování jeho metody nebo dokonce celou metodu novì vytvoøit. Navíc lze takovéto otevøení provádìt i u jednolivých objektù.

\textbf{Expertní systémy.} Expertní systém~\cite{expertSystems} je program, který umí odpovídat na dotazy uživatele na základì uložených znalostí. Svou funkèností simuluje rozhodování lidského experta a používá se v pøípadech, ve kterých neexistuje algoritmické øešení, pøípadnì na místech kde by takové øešení bylo pøílis složité èi špatnì udržovatelné. Zpravidla se skládá z nìkolika èástí: (1) Báze znalostí, kde jsou uložena pravidla umožnující mìnit, mazat a vyvozovat nová fakta z pracovní pamìti, (2) pracovní pamìt uchovavající známá fakta, (3) øídící algoritmus vykonavající vyhovující pravidla, (4) vysvìtlující podsystém pro zdùvodnìní dosaženého výsledku a také (5) uživatelské rozhraní pro komunikaci s uživatelem (a\v{t} už formou pøíkazového øádku nebo grafického rozhraní).

CLIPS\footnote{http://clipsrules.sourceforge.net/} je systém pro tvorbu expertních systémù, dnes dostupný jako public domain software. Je stále udržován pùvodním autorem a mimo této verze existují i další jeho varianty, které pùvodní CLIPS obohacují o nové možnosti - napøíklad FuzzyClips\footnote{http://www.nrc-cnrc.gc.ca/eng/projects/iit/fuzzy-reasoning.html}, což je rozšíøení o možnosti pracovat s fuzzy logikou nebo pøepis pro Javu jménem Jess\footnote{http://www.jessrules.com/}. Celý systém je napsaný v dobøe pøenositelném jazyce C, ovšem jazyk pro ovládání systému je velice podobný jazyku LISP (viz. obrázek \ref{clipsUkazka}).

\begin{figure}[tbh]
  \begin{verbatim}
(assert (zvire (jmeno "Azor") (vek 3) (rasa "vlcak")))
  \end{verbatim} 
  \vspace{-1.2cm}
    \caption{Ukázka vytvoøení faktu v CLIPS.}
    \label{clipsUkazka}
\end{figure}

Existují dva rùzné zpùsoby zpøístupnìní funkcionality knihoven psaných v jazyku C do skriptovacích jazykù\,--\,manuální a automatický. V prvním pøípadì si programátor napíše rozhraní mezi knihovnou a jazykem zcela sám a má tedy plnou kontrolu nad podobou výsledku. V druhém pøípadì lze využít utility, které toto rozhraní umí vygenerovat automaticky samy. Pøíkladem mùže být projekt SWIG\footnote{http://www.swig.org/}, který zpracuje zdrojové k\'{o}dy knihovny psané v C (pøípadnì C++), pro které vygeneruje obalovací k\'{o}d tak, aby šly pøeložit a použit jako binarní rozšíøení zvoleného cílového skriptovacího jazyka. V pøípadì SWIG patøí mezi podporované cílové jazyky Perl, PHP, Python, Tcl èi právì Ruby. Tento zpùsob je velice rychlý a pøímoèarý, bohužel v tomto pøípadì má programátor minimální možnost ovlivnit výsledek.

\section{Knihovna rbClips}
V rámci své bakaláøské práce jsem vytvoøil knihovnu rbClips, kde jsem manuálnì zpøístupnil funkce CLIPS z Ruby. Manuální pøístup pøevodu mi pøednì umožnil zapouzdøit procedurální chování CLIPS do objektù i pøizpùsobit rozhraní zvyklostem objektového návrhu a nepsaným hojnì rozšíøeným konvencím Ruby. Aplikaèní rozhraní (API) jsem navrhl po vzoru projektu ActiveRecords\footnote{http://ar.rubyonrails.org/} (AR). AR je knihovna zapouzdøující práci s relaèními databázemi do objekù. Pùvodne vznikla pro potøeby webového frameworku Ruby On Rails\footnote{http://rubyonrails.org/}, ale lze ji používat zcela nezávisle. Programátor se základní znalostí AR se velice rychle zorientuje i v používání rbClips.

Navíc jsem tak získal možnost odstínit koncového uživatele od znalosti syntaxe uživatelského rozhraní CLIPS. Nìkteré ménì využívané konstrukce nejsou bohužel v rbClips podporovány, a proto jsem pøidal možnost vkládat a vykonávat validní úryvky CLIPS k\'{o}du pøímo. Možnost zapouzdøit CLIPS a odebrat tak pro uživatele nutnost znalosti syntaxe velice podobné jazyku Lisp byl jeden z hlavních dùvodu proè jsem se rozhodl pro manuální pøístup.

Dalším dùležitým dùvodem je umožnìní zpìtného volání Ruby metod. Ve tøídì pro práci s pravidly lze jako akci (konsekvent) nastavit libovolný Ruby objekt a jeho metodu, jež po aktivaci pravidla mùže být zavolána i s aktivaèními parametry. Pro tuto funkcionalitu jsem si musel v CLIPS vytvoøit vlastní funkci, která je schopna zavolat na libovolném registrovaném Ruby objektu definovanou metodu. Samotná registrace je pro uživatele plnì transparentní a nemusí se jí zabývat. Díky tomu není v rámci pravidel uživatel svázán pouze schopnostmi stabilního jádra CLIPS, ale otevírají se mu úplnì nové možnosti. Do výsledného expertního systému mùže integrovat libovolnu knihovnu Ruby a plnì využít všech možností, které tento jazyk nabízí. 

Z technického pohledu je rbClips knihovna obsahující modul \verb|Clips| se ètyømi zakladními a nìkolika podpùrnými tøídami. Základní tøídy zapouzdøují možnost ovládání prostøedí CLIPS (tøída \verb|Base|), prací se šablonami (tøída \verb|Template|), fakty (\verb|Fact|) a nakonec také správu pravidel (\verb|Rule|). Podpùrné tøídy slouží napøíklad pro manipulaci s prostøedími (\verb|Environment|) èi poskytují možnost ovlivnit pøípustné hodnoty v jednotlivých pojmenovaných slotech faktù (\verb|Constraint|).

\section{Aktuální stav}
Knihovna ještì není zcela dokonèena. Funguje veškerá popsaná funkcionalita až na umožnìní zpìtného volání Ruby objektù, které je napsáno jen z èasti a není plnì stabilní.

\section{Reálné nasazení}
Tento projekt vznikl v rámci spoleènosti AVG Technologies s.r.o\footnote{http://www.avg.com} s cílem napodobit rozhodovací proces lidských odborníkù v oblasti analýzy virových vzorkù. Knihovna bude využita pro automatické napodobení postupu jejich analýzy, kterou by nad daným vzorkem provádìli. Bude rozhodovat zda-li je vzorek malware nebo èistý legitimní software. Výhody øešení postaveného pomocí rbClips jsou (1) jednoduché propojení programu s relaèními databázemi, kde jsou uloženy rùzné záznamy èi hledané kontrolní souèty, (2) snadnost volání externích utitil a rozhodování na základì jejich výsledku po vzoru lidského pracovníka a (3) možnost automaticky vytváøet nová pravidla podle zjištìných skuteèností, tedy strojové uèení.

Další využítí by knihovna mohla najít na stranì klienta AVG, tedy u uživatelù antivirového produktu, kde by expertní systém posloužil jako základ pro detekci malware na základì chování (behaviour detection). Operaèní systém bude hlásit antivirovému programu jednotlivé akce, které programy postupnì provádìjí (napøíklad alokace velkého bloku souvislé pamìti, rozšifrování dat do tohoto bloku a jeho následné spuštìní). Ten by rozhodoval na základì výstupu z rbClips umožnil varovat uživatele pøed podezøelým chováním jednolivých programù.

\section*{Podìkování}
Rád bych podìkoval technickému vedoucímu této prace, Ryanu Hicksovi, za nápad, rady a ochotu øešit problémy, na které jsem pøi tvorbì narazil a svému odbornému vedoucímu Zde\v{n}kovi Letkovi za jeho trpìlivost a èas vìnovaný kontrole korektnosti mých textù.

%------------
% Citace
%
\begin{thebibliography}{9}
  \bibitem{rubyProgrammingLanguage}  David Flanagan, Yukihiro Matsumoto: The
Ruby Programming Languag, O'Reilly Media, Inc 2008, ISBN 0-596-51617-7
  \bibitem{expertSystems} Josph C. Giarratano, Gary D. Rile: Expert Systems:
Principles and programming, Thomson Learning, Inc 2005, ISBN 0-534-38447-1
\end{thebibliography}
\end{document}
